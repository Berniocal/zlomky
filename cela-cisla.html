<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>CelÃ¡ ÄÃ­sla â€“ pokroÄilÃ½ trÃ©nink</title>
<meta name="theme-color" content="#0b1323" />
<style>
  :root{
    --bg:#0b1323; --panel:#0f1729; --text:#e6eef8; --muted:#9fb0c7; --accent:#60a5fa;
    --ok:#22c55e; --wrong:#ef4444; --card:#101826;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;
    background:linear-gradient(180deg,var(--bg),#0d1528);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
  }
  .app{max-width:min(900px,96vw);margin:24px auto; padding:16px}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px}

  /* OdmÄ›ny (pÃ¡n se Å¡edivÃ½mi vlasy) + ÄertÃ­ci */
  .heroes{position:fixed;top:10px;right:12px;display:flex;gap:6px;z-index:10}
  .hero{width:22px;height:22px;display:grid;place-items:center;filter:drop-shadow(0 0 6px #38bdf8)}
  .hero::before{content:"ğŸ‘¨â€ğŸ¦³";font-size:20px}
  .devils{position:fixed;top:40px;right:12px;display:flex;gap:6px;z-index:10}
  .devil{width:22px;height:22px;display:grid;place-items:center;filter:drop-shadow(0 0 6px #a855f7)}
  .devil::before{content:"ğŸ˜ˆ";font-size:18px}

  .panel{background:var(--panel);border:1px solid #1b2946;border-radius:18px;padding:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .tag{padding:4px 10px;border:1px solid #233152;border-radius:999px;color:var(--muted);font-size:12px}
  .big{font-size:20px}
  .btn{appearance:none;border:1px solid #25324f;background:#15203a;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
  .btn:hover{background:#182444}
  .btn.primary{border-color:#245bb5;background:#1b3b70}

  .qcard{background:var(--card);border:1px solid #1a2744;border-radius:16px;padding:14px}
  .qtitle{color:var(--muted);font-size:13px;margin-bottom:6px}
  .qtext{font-size:24px; line-height:1.2; white-space:nowrap; display:inline-block}
  .status{margin-top:8px;font-size:14px;color:var(--muted)}
  .footer{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
  .sep{height:1px;background:#1b2946;margin:14px 0}

  .answerRow{
    margin-top:14px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  .answerRow label{font-size:14px;color:var(--muted)}
  .answerRow input{
    min-width:120px;
    padding:8px 10px;
    border-radius:10px;
    border:1px solid #243356;
    background:#0f1729;
    color:var(--text);
    outline:none;
  }
  .answerRow input:focus{border-color:var(--accent)}

  /* VÅ¡echen text ÄistÄ› bÃ­lÃ½ */
  * { color: #ffffff !important; }
</style>
</head>
<body>
<div class="heroes" id="heroes"></div>
<div class="devils" id="devils"></div>

<div class="app">
  <header>
    <div class="row">
      <div class="tag">ÃšroveÅˆ: <span id="levelNo">1</span>/5</div>
      <div class="tag">PÅ™Ã­klad v tÃ©to Ãºrovni: <span id="inLevel">0</span>/6</div>
      <div class="tag">SprÃ¡vnÄ› v Å™adÄ›: <span id="streak">0</span>/6</div>
    </div>
    <div class="row">
      <button class="btn" id="btnReset">Reset</button>
      <button class="btn primary" id="btnNext" disabled>DalÅ¡Ã­</button>
    </div>
  </header>

  <section class="panel">
    <div class="row" style="justify-content:space-between">
      <div class="big" id="levelName">â€”</div>
      <div class="tag">OdmÄ›ny: <span id="heroesCount">0</span>/5 ğŸ‘¨â€ğŸ¦³</div>
    </div>
    <div class="sep"></div>

    <div id="card" class="qcard">
      <div class="qtitle" id="qTitle">PÅ™Ã­klad</div>
      <div class="qtext" id="qText">â€”</div>

      <div class="answerRow">
        <label for="answerInput">VÃ½sledek:</label>
        <input type="number" id="answerInput" inputmode="numeric" />
        <button class="btn" id="btnCheck">OvÄ›Å™it</button>
      </div>

      <div class="status" id="status"></div>
    </div>

    <div class="footer">
      <!-- DalÅ¡Ã­ Å™eÅ¡Ã­me pÅ™es btnNext nahoÅ™e -->
    </div>
  </section>

  <p class="status">
    5 ÃºrovnÃ­ prÃ¡ce s celÃ½mi ÄÃ­sly. V kaÅ¾dÃ© Ãºrovni musÃ­Å¡ zvlÃ¡dnout
    <strong>6 pÅ™Ã­kladÅ¯ za sebou bez chyby</strong>.
    Pak postoupÃ­Å¡ na dalÅ¡Ã­ ÃºroveÅˆ a zÃ­skÃ¡Å¡ ğŸ‘¨â€ğŸ¦³. Za kaÅ¾dou chybu pÅ™ibude ğŸ˜ˆ a ÃºroveÅˆ se zaÄÃ­nÃ¡ znovu (0/6).
  </p>
</div>

<script>
/* ----------------- PomocnÃ© funkce ----------------- */
function randInt(min, max){
  return Math.floor(Math.random()*(max-min+1))+min;
}
function choice(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}
function fmtInt(n){
  return n < 0 ? '('+n+')' : String(n);
}

/* VyhodnocenÃ­ vÃ½razu s klasickou prioritou operacÃ­ */
function evalExpr(expr){
  const js = expr
    .replace(/\s+/g,'')
    .replace(/Â·/g,'*')
    .replace(/:/g,'/')
    .replace(/âˆ’/g,'-')
    .replace(/\[/g,'(').replace(/\]/g,')')
    .replace(/\{/g,'(').replace(/\}/g,')');
  try{
    const val = Function('"use strict";return ('+js+');')();
    if(!Number.isFinite(val)) return null;
    return val;
  }catch(e){
    return null;
  }
}

/* ----------------- GenerÃ¡tory pÅ™Ã­kladÅ¯ ----------------- */
/* ÃšroveÅˆ 1 â€“ sÄÃ­tÃ¡nÃ­ a odÄÃ­tÃ¡nÃ­ dvou celÃ½ch ÄÃ­sel
   podmÃ­nka: kdyÅ¾ jedno je trojcifernÃ© (100â€“999), druhÃ© je jen dvojcifernÃ© (10â€“99) */
function genLevel1(){
  while(true){
    let a = randInt(-999,999);
    let b = randInt(-999,999);
    if(a === 0) a = choice([-9,-5,5,9]);
    if(b === 0) b = choice([-9,-5,5,9]);

    const da = Math.abs(a), db = Math.abs(b);
    const is3a = (da>=100 && da<=999);
    const is3b = (db>=100 && db<=999);

    if(is3a && !(db>=10 && db<=99)) continue;
    if(is3b && !(da>=10 && da<=99)) continue;

    const op = choice(['+','âˆ’']);
    const expr = fmtInt(a)+' '+op+' '+fmtInt(b);
    const val = evalExpr(expr);
    if(val === null) continue;
    if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
    return { text: expr, result: val };
  }
}

/* ÃšroveÅˆ 2 â€“ nÃ¡sobenÃ­ a dÄ›lenÃ­ celÃ½ch ÄÃ­sel
   - 2 ÄÃ­sla: nÃ¡sobenÃ­
   - 3 ÄÃ­sla: tvar (a Â· b) : c
   - u tÅ™Ã­ ÄÃ­sel: prÃ¡vÄ› jedno dvojcifernÃ©, ostatnÃ­ jednocifernÃ©, Å¾Ã¡dnÃ© a*...:a */
function genLevel2(){
  while(true){
    if(Math.random() < 0.4){
      // jen nÃ¡sobenÃ­ dvou ÄÃ­sel
      let a = randInt(-20,20);
      let b = randInt(-20,20);
      if(Math.abs(a)<=1) a = choice([-3,-2,2,3]);
      if(Math.abs(b)<=1) b = choice([-3,-2,2,3]);
      const expr = fmtInt(a)+' Â· '+fmtInt(b);
      const val = evalExpr(expr);
      if(val === null) continue;
      if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
      return { text: expr, result: val };
    }else{
      // (dvojcifernÃ© Â· jednocifernÃ©) : jednocifernÃ©
      let two = randInt(10,99)*(Math.random()<0.5 ? 1:-1);
      let s1 = randInt(2,9)*(Math.random()<0.5 ? 1:-1);
      let s2 = randInt(2,9)*(Math.random()<0.5 ? 1:-1);

      // vyhoÄ triviÃ¡lnÃ­ vzory |two| == |s2|
      if(Math.abs(two) === Math.abs(s2)) continue;

      const expr = '('+fmtInt(two)+' Â· '+fmtInt(s1)+') : '+fmtInt(s2);
      const val = evalExpr(expr);
      if(val === null) continue;
      if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
      return { text: expr, result: val };
    }
  }
}

/* ÃšroveÅˆ 3 â€“ 3 pÅ™Ã­klady jen +/âˆ’, 3 pÅ™Ã­klady mix s Â·/: */
function genLevel3AddSub(){
  while(true){
    const len = randInt(3,5); // poÄet ÄÃ­sel
    let first = randInt(-50,50);
    if(first === 0) first = choice([-7,-5,5,7]);
    let expr = fmtInt(first);

    for(let i=2;i<=len;i++){
      const op = choice(['+','âˆ’']);
      let n = randInt(-50,50);
      if(n === 0) n = choice([-7,-5,5,7]);
      expr += ' '+op+' '+fmtInt(n);
    }

    const val = evalExpr(expr);
    if(val === null) continue;
    if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
    return { text: expr, result: val };
  }
}

function genLevel3Mix(){
  while(true){
    const len = randInt(3,5);
    let first = randInt(-12,12);
    if(first === 0) first = choice([-5,-3,3,5]);
    let expr = fmtInt(first);
    let hasMulDiv = false;

    for(let i=2;i<=len;i++){
      let op = choice(['+','âˆ’','Â·',':']);
      if(i === len && !hasMulDiv) op = choice(['Â·',':']);
      let n = randInt(-9,9);
      if(n === 0) n = choice([-3,-2,2,3]);
      expr += ' '+op+' '+fmtInt(n);
      if(op === 'Â·' || op === ':') hasMulDiv = true;
    }

    const val = evalExpr(expr);
    if(val === null) continue;
    if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
    if(!hasMulDiv) continue;
    return { text: expr, result: val };
  }
}

function genLevel3(){
  // 50 % jen +/âˆ’, 50 % mix
  if(Math.random() < 0.5) return genLevel3AddSub();
  return genLevel3Mix();
}

/* ÃšroveÅˆ 4 â€“ v kaÅ¾dÃ©m pÅ™Ã­kladu vÅ¡echny 4 operace */
function genLevel4(){
  while(true){
    const len = randInt(5,7); // poÄet ÄÃ­sel
    let first = randInt(-12,12);
    if(first === 0) first = choice([-5,-3,3,5]);
    let expr = fmtInt(first);

    const opsAll = ['+','âˆ’','Â·',':'];
    const opsUsed = new Set();

    for(let i=2;i<=len;i++){
      let op = choice(opsAll);
      if(i === len){
        const missing = opsAll.filter(o => !opsUsed.has(o));
        if(missing.length) op = choice(missing);
      }
      let n = randInt(-9,9);
      if(n === 0) n = choice([-3,-2,2,3]);
      expr += ' '+op+' '+fmtInt(n);
      opsUsed.add(op);
    }

    const val = evalExpr(expr);
    if(val === null) continue;
    if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
    if(!opsAll.every(o => opsUsed.has(o))) continue;
    return { text: expr, result: val };
  }
}

/* ÃšroveÅˆ 5 â€“ zÃ¡vorky (), [] , {}, 6â€“10 ÄÃ­sel, vÅ¡echny operace */
function genLevel5(){
  while(true){
    const A = randInt(-20,20) || 3;
    const B = randInt(-20,20) || -5;
    const C = randInt(-20,20) || 7;

    const D = randInt(2,15)*(Math.random()<0.5?1:-1);
    const absD = Math.abs(D);
    const divisors = [];
    for(let e=2; e<=Math.min(15,absD); e++){
      if(absD % e === 0) divisors.push(e);
    }
    if(divisors.length === 0) continue;
    let E = choice(divisors)*(Math.random()<0.5?1:-1);

    let F = randInt(-30,30) || 4;
    let G = randInt(-20,20) || -3;

    let expr = '('+fmtInt(A)+' + ['+fmtInt(B)+' âˆ’ '+fmtInt(C)+']) Â· {'+
               fmtInt(D)+' : '+fmtInt(E)+'} âˆ’ '+fmtInt(F)+' + '+fmtInt(G);

    // moÅ¾nost pÅ™idat jeÅ¡tÄ› jednu zÃ¡vorku, aÅ¥ je vÃ­c ÄÃ­sel
    if(Math.random() < 0.5){
      let H = randInt(-15,15) || 5;
      let I = randInt(-15,15) || -6;
      const op = Math.random() < 0.5 ? '+' : 'âˆ’';
      expr += ' '+op+' ('+fmtInt(H)+' + '+fmtInt(I)+')';
    }

    const val = evalExpr(expr);
    if(val === null) continue;
    if(!Number.isInteger(val) || Math.abs(val)>1000) continue;
    return { text: expr, result: val };
  }
}

/* Dispatcher podle ÃºrovnÄ› */
const LEVELS = [
  { name:'1) SÄÃ­tÃ¡nÃ­ a odÄÃ­tÃ¡nÃ­ celÃ½ch ÄÃ­sel', gen:genLevel1 },
  { name:'2) NÃ¡sobenÃ­ a dÄ›lenÃ­ celÃ½ch ÄÃ­sel', gen:genLevel2 },
  { name:'3) SmÃ­Å¡enÃ© pÅ™Ã­klady s vÃ­ce ÄÃ­sly', gen:genLevel3 },
  { name:'4) VÅ¡echny 4 operace v jednom pÅ™Ã­kladu', gen:genLevel4 },
  { name:'5) ZÃ¡vorky (), [], {} + vÅ¡echny operace', gen:genLevel5 }
];

/* ----------------- Stav a UI ----------------- */
let levelIndex = 0;      // 0..4
let inLevel = 0;         // 0..6
let streak = 0;          // 0..6
let current = null;      // { text, result }

const QUESTIONS_PER_LEVEL = 6;

const elLevelNo = document.getElementById('levelNo');
const elLevelName = document.getElementById('levelName');
const elInLevel = document.getElementById('inLevel');
const elStreak = document.getElementById('streak');
const elHeroes = document.getElementById('heroes');
const elDevils = document.getElementById('devils');
const elHeroesCount = document.getElementById('heroesCount');

const elQTitle = document.getElementById('qTitle');
const elQText = document.getElementById('qText');
const elStatus = document.getElementById('status');
const elAnswer = document.getElementById('answerInput');

const elBtnNext = document.getElementById('btnNext');
const elBtnReset = document.getElementById('btnReset');
const elBtnCheck = document.getElementById('btnCheck');

function updateHeader(){
  elLevelNo.textContent = String(levelIndex+1);
  elLevelName.textContent = LEVELS[levelIndex].name;
  elInLevel.textContent = String(inLevel);
  elStreak.textContent = String(streak);
  elHeroesCount.textContent = String(elHeroes.children.length);
}

function setStatus(msg){
  elStatus.textContent = msg;
}

/* NovÃ½ pÅ™Ã­klad v aktuÃ¡lnÃ­ Ãºrovni */
function nextQuestion(){
  if(levelIndex >= LEVELS.length){
    elQTitle.textContent = 'Hotovo!';
    elQText.textContent = 'DokonÄil jsi vÅ¡echny ÃºrovnÄ›.';
    setStatus('');
    elBtnCheck.disabled = true;
    elBtnNext.disabled = true;
    return;
  }

  const gen = LEVELS[levelIndex].gen;
  const q = gen();
  current = q;

  inLevel = streak; // kolik uÅ¾ mÃ¡ sprÃ¡vnÄ› â†’ pÅ™Ã­klad (streak+1)
  elQTitle.textContent = 'PÅ™Ã­klad '+(streak+1)+' z '+QUESTIONS_PER_LEVEL;
  elQText.textContent = q.text;

  elAnswer.value = '';
  elAnswer.focus();
  setStatus('');
  elBtnCheck.disabled = false;
  elBtnNext.disabled = true;

  elInLevel.textContent = String(streak);
}

/* Kontrola odpovÄ›di z inputu */
function checkAnswer(){
  if(!current) return;
  const raw = elAnswer.value.trim();
  if(raw === ''){
    setStatus('Zadej vÃ½sledek jako celÃ© ÄÃ­slo.');
    return;
  }
  const userVal = Number(raw);
  if(!Number.isFinite(userVal) || !Number.isInteger(userVal)){
    setStatus('Zadej prosÃ­m celÃ© ÄÃ­slo (bez desetinnÃ© ÄÃ¡rky).');
    return;
  }

  if(userVal === current.result){
    streak++;
    inLevel = streak;
    elStreak.textContent = String(streak);
    elInLevel.textContent = String(inLevel);

    if(streak >= QUESTIONS_PER_LEVEL){
      // celÃ¡ ÃºroveÅˆ bez chyby
      const hero = document.createElement('div');
      hero.className = 'hero';
      elHeroes.appendChild(hero);
      elHeroesCount.textContent = String(elHeroes.children.length);

      if(levelIndex < LEVELS.length-1){
        setStatus('VÃ½bornÄ›! ÃšroveÅˆ '+(levelIndex+1)+' je bez chyby. ğŸ‘¨â€ğŸ¦³ Stiskni "DalÅ¡Ã­" pro dalÅ¡Ã­ ÃºroveÅˆ.');
      }else{
        setStatus('SkvÄ›le! DokonÄil jsi vÅ¡echny ÃºrovnÄ›. ğŸ‘¨â€ğŸ¦³');
      }
    }else{
      setStatus('SprÃ¡vnÄ›! Stiskni "DalÅ¡Ã­" pro dalÅ¡Ã­ pÅ™Ã­klad.');
    }

    elBtnCheck.disabled = true;
    elBtnNext.disabled = false;
  }else{
    // Å¡patnÄ› â€“ ÄertÃ­k a restart ÃºrovnÄ›
    const devil = document.createElement('div');
    devil.className = 'devil';
    elDevils.appendChild(devil);

    streak = 0;
    inLevel = 0;
    elStreak.textContent = '0';
    elInLevel.textContent = '0';

    setStatus('Å patnÄ›. Tuto ÃºroveÅˆ zaÄneÅ¡ znovu od zaÄÃ¡tku (0/6). Stiskni "DalÅ¡Ã­" pro novÃ½ pÅ™Ã­klad v tÃ©to Ãºrovni.');
    elBtnCheck.disabled = true;
    elBtnNext.disabled = false;
  }
}

/* DalÅ¡Ã­ â€“ buÄ novÃ½ pÅ™Ã­klad v tÃ©Å¾e Ãºrovni, nebo posun na dalÅ¡Ã­ ÃºroveÅˆ */
function goNext(){
  if(streak >= QUESTIONS_PER_LEVEL){
    if(levelIndex < LEVELS.length-1){
      levelIndex++;
      streak = 0;
      inLevel = 0;
      updateHeader();
      nextQuestion();
    }else{
      // vÅ¡echny ÃºrovnÄ› hotovÃ©
      setStatus('VÅ¡echny ÃºrovnÄ› jsou dokonÄenÃ©.');
      elBtnNext.disabled = true;
      elBtnCheck.disabled = true;
    }
  }else{
    // pokraÄujeme v tÃ© samÃ© Ãºrovni od zaÄÃ¡tku sÃ©rie
    nextQuestion();
  }
}

/* Reset vÅ¡eho */
function resetAll(){
  levelIndex = 0;
  streak = 0;
  inLevel = 0;
  elHeroes.innerHTML = '';
  elDevils.innerHTML = '';
  elHeroesCount.textContent = '0';
  updateHeader();
  elBtnNext.disabled = true;
  elBtnCheck.disabled = false;
  nextQuestion();
}

/* OvlÃ¡dÃ¡nÃ­ */
elBtnCheck.addEventListener('click', checkAnswer);
elBtnNext.addEventListener('click', goNext);
elBtnReset.addEventListener('click', resetAll);
elAnswer.addEventListener('keydown', e=>{
  if(e.key === 'Enter'){
    e.preventDefault();
    if(!elBtnCheck.disabled) checkAnswer();
  }
});

/* start */
updateHeader();
nextQuestion();
</script>
</body>
</html>
