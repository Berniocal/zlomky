<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Zlomky ‚Äì pokroƒçil√Ω tr√©nink</title>
<meta name="theme-color" content="#0b1323" />
<style>
  :root{
    --bg:#0b1323; --panel:#0f1729; --text:#e6eef8; --muted:#9fb0c7; --accent:#60a5fa;
    --ok:#22c55e; --wrong:#ef4444; --card:#101826;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#0d1528);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:min(900px,96vw);margin:24px auto; padding:16px}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:16px}

  /* Srd√≠ƒçka + ƒçert√≠ci (stav) */
  .hearts{position:fixed;top:10px;right:12px;display:flex;gap:6px;z-index:10}
  .heart{width:20px;height:20px;display:grid;place-items:center;filter:drop-shadow(0 0 6px #f87171)}
  .heart::before{content:"‚ù§";font-size:18px}
  .devils{position:fixed;top:36px;right:12px;display:flex;gap:6px;z-index:10}
  .devil{width:20px;height:20px;display:grid;place-items:center;filter:drop-shadow(0 0 6px #a855f7)}
  .devil::before{content:"üòà";font-size:18px}

  .panel{background:var(--panel);border:1px solid #1b2946;border-radius:18px;padding:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .tag{padding:4px 10px;border:1px solid #233152;border-radius:999px;color:var(--muted);font-size:12px}
  .big{font-size:20px}
  .btn{appearance:none;border:1px solid #25324f;background:#15203a;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
  .btn:hover{background:#182444}
  .btn.primary{border-color:#245bb5;background:#1b3b70}

  .qcard{background:var(--card);border:1px solid #1a2744;border-radius:16px;padding:14px}
  .qtitle{color:var(--muted);font-size:13px;margin-bottom:6px}
  .qtext{font-size:22px; line-height:1.2; white-space:nowrap; display:inline-block}
  .opts{display:grid;gap:10px;margin-top:12px}
  .opt{border:1px solid #273454;background:#141d34;border-radius:12px;padding:10px 12px;cursor:pointer;text-align:left}
  .opt:hover{background:#18223c}
  .opt.correct{outline:2px solid var(--ok)}
  .opt.wrong{outline:2px solid var(--wrong)}
  .status{margin-top:8px;font-size:14px;color:var(--muted)}
  .footer{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
  .sep{height:1px;background:#1b2946;margin:14px 0}

  /* Zlomky (jednoduch√© i slo≈æen√©) */
  .frac, .cfrac{display:inline-flex; flex-direction:column; align-items:center; justify-content:center; vertical-align:middle; line-height:1}
  .frac .num, .frac .den, .cfrac .num, .cfrac .den{padding:0 6px; text-align:center; display:block}
  .frac .bar, .cfrac .bar{height:2px; width:100%; background:#cfe3ff; margin:3px 0}
  .mixed{display:inline-flex;gap:6px;align-items:center}

  /* V≈°echen text ƒçistƒõ b√≠l√Ω */
  * { color: #ffffff !important; }
</style>
</head>
<body>
<div class="hearts" id="hearts"></div>
<div class="devils" id="devils"></div>

<div class="app">
  <header>
    <div class="row">
      <div class="tag">Kolo: <span id="roundNo">1</span></div>
      <div class="tag">Ot√°zka v kole: <span id="inRound">1</span>/<span id="perRound">3</span></div>
      <div class="tag">Bezchybnƒõ toto kolo: <span id="streak">0</span>/<span id="perRound2">3</span></div>
    </div>
    <div class="row">
      <button class="btn" id="btnReset">Reset</button>
      <button class="btn primary" id="btnNext" disabled>Dal≈°√≠</button>
    </div>
  </header>

  <section class="panel">
    <div class="row" style="justify-content:space-between">
      <div class="big" id="catName">‚Äî</div>
      <div class="tag">Zb√Ωv√° v kategorii: <span id="leftInCat">‚Äî</span></div>
    </div>
    <div class="sep"></div>

    <div id="card" class="qcard">
      <div class="qtitle" id="qTitle">P≈ô√≠klad</div>
      <div class="qtext" id="qText">‚Äî</div>
      <div class="opts" id="options"></div>
      <div class="status" id="status"></div>
    </div>

    <div class="footer">
      <button class="btn" id="btnNewRound" disabled>Dal≈°√≠ kolo</button>
    </div>
  </section>

  <p class="status">
    Pokroƒçil√° verze: 3 kategorie √ó 10 √∫loh. V ka≈æd√©m kole n√°hodnƒõ 1 √∫loha z ka≈æd√© kategorie (max. 10 kol).  
    Kolo bez chyby p≈ôid√° ‚ù§, ka≈æd√° chyba p≈ôid√° üòà. √ölohy se neopakuj√≠.
  </p>
</div>

<script>
/* ---------- Racion√°ln√≠ aritmetika ---------- */
function gcd(a,b){a=Math.abs(a);b=Math.abs(b);while(b){[a,b]=[b,a%b]}return a||1}
function simplify(fr){ if(fr.den<0){fr.num*=-1;fr.den*=-1} const g=gcd(fr.num,fr.den); return {num:fr.num/g, den:fr.den/g}; }
function f(n,d){return simplify({num:n,den:d})}
function add(a,b){return simplify({num:a.num*b.den+b.num*a.den, den:a.den*b.den})}
function sub(a,b){return simplify({num:a.num*b.den-b.num*a.den, den:a.den*b.den})}
function mul(a,b){return simplify({num:a.num*b.num, den:a.den*b.den})}
function divr(a,b){return simplify({num:a.num*b.den, den:a.den*b.num})}
function mix(w,n,d){return add(f(w,1), f(n,d))}
function fromDec(str){
  str = String(str).trim().replace(/\s/g,'').replace(',', '.');
  if(!str.includes('.')) return f(parseInt(str,10),1);
  const [i,dec]=str.split('.');
  const k = dec.length, den = 10**k;
  const sgn = str.trim().startsWith('-') ? -1 : 1;
  const num = sgn*Math.abs(parseInt(i||'0',10))*den + (sgn*parseInt(dec,10));
  return simplify({num,den});
}

/* ---------- Vykreslov√°n√≠ ---------- */
function toDisplay(fr){
  fr = simplify(fr);
  if(fr.den===1) return `${fr.num}`;
  const sgn = fr.num<0 ? -1 : 1;
  const anum = Math.abs(fr.num);
  if(anum > fr.den){
    const w = Math.trunc(anum / fr.den)*sgn;
    const r = anum % fr.den;
    return `<span class="mixed"><span>${w}</span><span class="frac"><span class="num">${r}</span><span class="bar"></span><span class="den">${fr.den}</span></span></span>`;
  }
  return `<span class="frac"><span class="num">${fr.num}</span><span class="bar"></span><span class="den">${fr.den}</span></span>`;
}
function fracHTML(numHTML, denHTML){
  return `<span class="cfrac"><span class="num">${numHTML}</span><span class="bar"></span><span class="den">${denHTML}</span></span>`;
}
function eq(a,b){a=simplify(a);b=simplify(b);return a.num===b.num && a.den===b.den}

/* ---------- Distraktory ---------- */
function nearFractions(base){
  const res = new Set();
  const addIf = (x)=>{const k = simplify(x); const key = k.num+'/'+k.den; if(!eq(k,base)) res.add(key);};
  addIf(add(base, f(1, Math.max(2, Math.min(20, base.den)))));
  addIf(sub(base, f(1, Math.max(2, Math.min(20, base.den+1)))));
  addIf({num:base.num+1, den:base.den});
  addIf({num:base.num-1, den:base.den});
  addIf({num:base.num, den:base.den+1});
  addIf({num:base.num, den:Math.max(1, base.den-1)});
  addIf(mul(base, f(11,10)));
  addIf(mul(base, f(9,10)));
  if(base.num!==0) addIf({num:base.den, den:base.num});
  const arr=[...res].slice(0,10).map(s=>{const [n,d]=s.split('/').map(Number);return {num:n,den:d}});
  while(arr.length<2) arr.push(add(base, f(1,7)));
  return arr.slice(0,2);
}

/* ---------- √ölohy (3√ó10 = 30) ---------- */
function Q(textHTML, value){ return { textHTML, value } }
const CATS = [
  {name:"1) Slo≈æen√© a vno≈ôen√© zlomky (pokroƒçil√©)", items:[]},
  {name:"2) Kombinovan√© v√Ωrazy (v√≠cekrokov√©)", items:[]},
  {name:"3) Mix ‚Äì slo≈æen√© zlomky v kombinac√≠ch", items:[]},
];

/* 1) Slo≈æen√© a vno≈ôen√© zlomky (10) */
CATS[0].items.push(
  (function(){ const a=mul(divr(f(3,4),f(9,16)), f(5,6));
    return Q(`${fracHTML(toDisplay(f(3,4)),toDisplay(f(9,16)))} ¬∑ ${toDisplay(f(5,6))}`, a); })(),
  (function(){ const a=divr(divr(f(7,9),f(14,27)), f(3,5));
    return Q(`${fracHTML(toDisplay(f(7,9)),toDisplay(f(14,27)))} : ${toDisplay(f(3,5))}`, a); })(),
  (function(){ const a=divr(add(f(2,3),f(1,2)), f(5,6));
    return Q(`${fracHTML( toDisplay(f(2,3))+' + '+toDisplay(f(1,2)), toDisplay(f(5,6)) )}`, a); })(),
  (function(){ const a=mul(divr(mix(1,1,2), f(3,5)), f(4,7));
    return Q(`${fracHTML( toDisplay(mix(1,1,2)), toDisplay(f(3,5)) )} ¬∑ ${toDisplay(f(4,7))}`, a); })(),
  (function(){ const a=add(divr(fromDec("0,8"), f(2,5)), f(1,6));
    return Q(`${fracHTML('0,8', toDisplay(f(2,5)))} + ${toDisplay(f(1,6))}`, a); })(),
 (function(){ const b=divr(f(3,7), f(6,35)); const a=divr(f(5,8), b);
  return Q(`${fracHTML( toDisplay(f(5,8)), fracHTML(toDisplay(f(3,7)), toDisplay(f(6,35))) )}`, a);
})(),

  (function(){ const a=divr(sub(mix(1,3,4), f(2,5)), sub(f(7,10), f(1,4)));
    return Q(`${fracHTML( '('+toDisplay(mix(1,3,4))+' ‚àí '+toDisplay(f(2,5))+')', '('+toDisplay(f(7,10))+' ‚àí '+toDisplay(f(1,4))+')' )}`, a); })(),
(function(){ const a=divr(mul(f(12,7), f(14,9)), add(f(5,6), f(1,3)));
  return Q(`${fracHTML( toDisplay(f(12,7))+' ¬∑ '+toDisplay(f(14,9)), fracHTML(toDisplay(f(4,15)), toDisplay(f(2,9))) )}`, a);
})(),

  (function(){ const a=divr(add(f(3,5), fromDec("0,4")), mix(1,1,4));
    return Q(`${fracHTML( toDisplay(f(3,5))+' + 0,4', toDisplay(mix(1,1,4)) )}`, a); })(),
  (function(){ const a=mul(divr(f(7,12), f(5,18)), sub(mix(2,1,3), fromDec("0,5")));
    return Q(`${fracHTML( toDisplay(f(7,12)), toDisplay(f(5,18)) )} ¬∑ ( ${toDisplay(mix(2,1,3))} ‚àí 0,5 )`, a); })()
);

/* 2) Kombinovan√© v√Ωrazy (10) */
CATS[1].items.push(
  (function(){ const a=mul(add(f(2,3),f(1,4)), sub(f(5,6), f(1,3)));
    return Q(`( ${toDisplay(f(2,3))} + ${toDisplay(f(1,4))} ) ¬∑ ( ${toDisplay(f(5,6))} ‚àí ${toDisplay(f(1,3))} )`, a); })(),
  (function(){ const a=divr(add(mix(1,2,5), f(3,10)), add(f(3,4), fromDec("0,2")));
    return Q(`( ${toDisplay(mix(1,2,5))} + ${toDisplay(f(3,10))} ) : ( ${toDisplay(f(3,4))} + 0,2 )`, a); })(),
  (function(){ const a=divr(mul(fromDec("2,75"), add(f(4,9), f(5,6))), sub(mix(1,1,2), f(3,8)));
    return Q(`2,75 ¬∑ ( ${toDisplay(f(4,9))} + ${toDisplay(f(5,6))} ) : ( ${toDisplay(mix(1,1,2))} ‚àí ${toDisplay(f(3,8))} )`, a); })(),
  (function(){ const a=mul(add(sub(f(5,8), f(1,3)), f(3,10)), divr(f(7,15), f(14,25)));
    return Q(`( ${toDisplay(f(5,8))} ‚àí ${toDisplay(f(1,3))} + ${toDisplay(f(3,10))} ) ¬∑ ${fracHTML(toDisplay(f(7,15)),toDisplay(f(14,25)))}`, a); })(),
  (function(){ const a=add(divr(f(9,4), fromDec("2,5")), mul(f(3,7), f(14,9)));
    return Q(`${toDisplay(f(9,4))} : 2,5 + ${toDisplay(f(3,7))} ¬∑ ${toDisplay(f(14,9))}`, a); })(),
  (function(){ const a=sub(divr(fromDec("3,6"), f(6,11)), mul(mix(1,1,3), f(5,9)));
    return Q(`3,6 : ${toDisplay(f(6,11))} ‚àí ${toDisplay(mix(1,1,3))} ¬∑ ${toDisplay(f(5,9))}`, a); })(),
  (function(){ const a=divr(divr(f(4,5), f(2,15)), divr(f(7,9), f(7,3)));
    return Q(`( ${toDisplay(f(4,5))} : ${toDisplay(f(2,15))} ) : ( ${toDisplay(f(7,9))} : ${toDisplay(f(7,3))} )`, a); })(),
  (function(){ const a=mul(add(mix(1,2,3), mix(2,1,2)), add(f(5,12), f(3,8)));
    return Q(`( ${toDisplay(mix(1,2,3))} + ${toDisplay(mix(2,1,2))} ) ¬∑ ( ${toDisplay(f(5,12))} + ${toDisplay(f(3,8))} )`, a); })(),
  (function(){ const a=divr(add(f(7,12), f(5,18)), sub(f(2,3), f(1,6)));
    return Q(`( ${toDisplay(f(7,12))} + ${toDisplay(f(5,18))} ) : ( ${toDisplay(f(2,3))} ‚àí ${toDisplay(f(1,6))} )`, a); })(),
  (function(){ const a=mul(add(fromDec("0,75"), f(3,8)), add(f(5,7), f(2,5)));
    return Q(`( 0,75 + ${toDisplay(f(3,8))} ) ¬∑ ( ${toDisplay(f(5,7))} + ${toDisplay(f(2,5))} )`, a); })()
);

/* 3) Mix ‚Äì slo≈æen√© zlomky v kombinac√≠ch (10) */
CATS[2].items.push(
  (function(){ const a=divr(add(f(2,3), f(1,5)), sub(f(3,4), f(1,6)));
    return Q(`${fracHTML( toDisplay(f(2,3))+' + '+toDisplay(f(1,5)), toDisplay(f(3,4))+' ‚àí '+toDisplay(f(1,6)) )}`, a); })(),
  (function(){ const a=divr(divr(f(5,8), f(3,16)), add(mix(1,1,4), f(2,5)));
    return Q(`${fracHTML( toDisplay(f(5,8))+' : '+toDisplay(f(3,16)), toDisplay(mix(1,1,4))+' + '+toDisplay(f(2,5)) )}`, a); })(),
  (function(){ const a=divr(mul(add(f(3,7), f(2,3)), sub(f(4,5), f(1,2))), f(9,10));
    return Q(`${fracHTML( '( '+toDisplay(f(3,7))+' + '+toDisplay(f(2,3))+' ) ¬∑ ( '+toDisplay(f(4,5))+' ‚àí '+toDisplay(f(1,2))+' )', toDisplay(f(9,10)) )}`, a); })(),
  (function(){ const a=add(divr(sub(fromDec("2,4"), f(3,5)), f(3,4)), f(1,3));
    return Q(`${fracHTML( '2,4 ‚àí '+toDisplay(f(3,5)), toDisplay(f(3,4)) )} + ${toDisplay(f(1,3))}`, a); })(),
  (function(){ const a=add(divr(f(3,5), f(7,10)), divr(f(1,2), f(3,4)));
    return Q(`${fracHTML( toDisplay(f(3,5)), toDisplay(f(7,10)) )} + ${fracHTML( toDisplay(f(1,2)), toDisplay(f(3,4)) )}`, a); })(),
  (function(){ const a=mul(divr(add(f(3,5), f(1,2)), sub(f(7,10), f(1,5))), f(4,7));
    return Q(`${fracHTML( toDisplay(f(3,5))+' + '+toDisplay(f(1,2)), toDisplay(f(7,10))+' ‚àí '+toDisplay(f(1,5)) )} ¬∑ ${toDisplay(f(4,7))}`, a); })(),
  (function(){ const a=divr(mul(f(12,7), f(14,9)), divr(f(4,15), f(2,9)));
  return Q(`${fracHTML( toDisplay(f(12,7))+' ¬∑ '+toDisplay(f(14,9)), fracHTML(toDisplay(f(4,15)),toDisplay(f(2,9))) )}`, a); 
})(),

  (function(){ const n=divr(add(f(3,5), f(1,2)), f(7,10)); const a=divr(n, sub(mix(2,1,4), f(1,3)));
  return Q(`${fracHTML( fracHTML( toDisplay(f(3,5))+' + '+toDisplay(f(1,2)), toDisplay(f(7,10)) ), '( '+toDisplay(mix(2,1,4))+' ‚àí '+toDisplay(f(1,3))+' )' )}`, a);
})(),

  (function(){ const a=mul(divr(add(mix(2,2,3), f(7,12)), add(f(3,4), f(2,9))), sub(fromDec("0,75"), f(1,5)));
    return Q(`${fracHTML( toDisplay(mix(2,2,3))+' + '+toDisplay(f(7,12)), toDisplay(f(3,4))+' + '+toDisplay(f(2,9)) )} ¬∑ ( 0,75 ‚àí ${toDisplay(f(1,5))} )`, a); })(),
  (function(){ const a=divr(divr(sub(f(7,9), f(2,7)), add(f(5,6), f(1,3))), sub(fromDec("1,2"), f(2,5)));
    return Q(`${fracHTML( '( '+toDisplay(f(7,9))+' ‚àí '+toDisplay(f(2,7))+' )', toDisplay(f(5,6))+' + '+toDisplay(f(1,3)) )} : ( 1,2 ‚àí ${toDisplay(f(2,5))} )`, a); })()
);

/* ---------- Stav a UI ---------- */
let round = 1, inRound = 0, roundCorrect = 0;
const used = CATS.map(()=>new Set());
let current = null;

const elCatName = document.getElementById('catName');
const elLeftInCat = document.getElementById('leftInCat');
const elQTitle = document.getElementById('qTitle');
const elQText = document.getElementById('qText');
const elOptions = document.getElementById('options');
const elStatus = document.getElementById('status');
const elRoundNo = document.getElementById('roundNo');
const elInRound = document.getElementById('inRound');
const elStreak = document.getElementById('streak');
const elPerRound = document.getElementById('perRound');
const elPerRound2 = document.getElementById('perRound2');
const elBtnNext = document.getElementById('btnNext');
const elBtnNewRound = document.getElementById('btnNewRound');
const elBtnReset = document.getElementById('btnReset');
const elHearts = document.getElementById('hearts');
const elDevils = document.getElementById('devils');

const QUESTIONS_PER_ROUND = CATS.length;
elPerRound.textContent = String(QUESTIONS_PER_ROUND);
elPerRound2.textContent = String(QUESTIONS_PER_ROUND);

function pickFromCategory(catIdx){
  const cat = CATS[catIdx];
  const available = [];
  for(let i=0;i<cat.items.length;i++) if(!used[catIdx].has(i)) available.push(i);
  if(available.length===0) return null;
  const qIndex = available[Math.floor(Math.random()*available.length)];
  return {catIdx, qIndex};
}

function startNextQuestion(){
  elStatus.textContent = '';
  elOptions.innerHTML = '';
  elBtnNext.disabled = true;

  if(inRound>=QUESTIONS_PER_ROUND){
    if(roundCorrect===QUESTIONS_PER_ROUND){
      const heart = document.createElement('div'); heart.className='heart'; elHearts.appendChild(heart);
      elStatus.innerHTML = `Kolo ${round} hotovo <strong>bez chyby</strong>! ‚ù§`;
    }else{
      elStatus.innerHTML = `Kolo ${round} hotovo. Spr√°vnƒõ ${roundCorrect}/${QUESTIONS_PER_ROUND}.`;
    }
    elBtnNewRound.disabled = false;
    return;
  }

  const catIdx = inRound; // po≈ôad√≠ kategori√≠ v kole
  const picked = pickFromCategory(catIdx);
  if(!picked){
    elCatName.textContent = CATS[catIdx].name;
    elLeftInCat.textContent = '0';
    elQTitle.textContent = 'V t√©to kategorii do≈°ly nov√© √∫lohy.';
    elQText.innerHTML = 'Zkus dal≈°√≠ kolo, nebo stiskni Reset.';
    elBtnNewRound.disabled = false;
    return;
  }

  const cat = CATS[catIdx];
  const q = cat.items[picked.qIndex];
  used[catIdx].add(picked.qIndex);
  current = {catIndex:catIdx, qIndex:picked.qIndex, correct:q.value};

  elCatName.textContent = cat.name;
  const left = cat.items.length - used[catIdx].size;
  elLeftInCat.textContent = String(left);
  elQTitle.textContent = `√öloha #${picked.qIndex+1}`;
  elQText.innerHTML = q.textHTML;

  const distractors = nearFractions(q.value);
  const all = [q.value, ...distractors].sort(()=>Math.random()-0.5);
  current.options = all;

  all.forEach((val)=>{
    const b = document.createElement('button');
    b.className='opt';
    b.innerHTML = toDisplay(val);
    b.addEventListener('click', ()=>{
      if(b.dataset.locked==='1') return;
      [...elOptions.children].forEach(x=>x.dataset.locked='1');

      if(eq(val, current.correct)){
        b.classList.add('correct');
        elStatus.textContent = 'Spr√°vnƒõ!';
        roundCorrect++;
      }else{
        b.classList.add('wrong');
        elStatus.textContent = '≈†patnƒõ.';
        [...elOptions.children].forEach(x=>{
          if(x.innerHTML===toDisplay(current.correct)) x.classList.add('correct');
        });
        const devil = document.createElement('div');
        devil.className = 'devil';
        elDevils.appendChild(devil);
      }
      elBtnNext.disabled = false;
    });
    elOptions.appendChild(b);
  });

  inRound++;
  elInRound.textContent = String(inRound);
  elStreak.textContent = String(roundCorrect);
}

function newRound(){
  round++;
  inRound = 0;
  roundCorrect = 0;
  elRoundNo.textContent = String(round);
  elInRound.textContent = '0';
  elStreak.textContent = '0';
  elBtnNewRound.disabled = true;
  startNextQuestion();
}

function resetAll(){
  round = 1; inRound = 0; roundCorrect = 0;
  for(let i=0;i<used.length;i++) used[i].clear();
  elHearts.innerHTML = '';
  elDevils.innerHTML = '';
  elRoundNo.textContent = '1'; elInRound.textContent = '0'; elStreak.textContent = '0';
  elBtnNewRound.disabled = true;
  startNextQuestion();
}

/* ovl√°d√°n√≠ */
elBtnNext.addEventListener('click', startNextQuestion);
elBtnNewRound.addEventListener('click', newRound);
elBtnReset.addEventListener('click', resetAll);

/* start */
startNextQuestion();
</script>
</body>
</html>
