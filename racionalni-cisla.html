<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Racion√°ln√≠ ƒç√≠sla ‚Äì 6 n√°hodn√Ωch p≈ô√≠klad≈Ø</title>
<meta name="theme-color" content="#0b1323" />
<style>
  :root{
    --bg:#0b1323; --panel:#0f1729; --text:#e6eef8; --muted:#9fb0c7; --accent:#60a5fa;
    --ok:#22c55e; --wrong:#ef4444; --card:#101826;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%;margin:0;
    background:linear-gradient(180deg,var(--bg),#0d1528);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
  }
  .app{max-width:min(800px,96vw);margin:24px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px;flex-wrap:wrap}
  .tag{
    padding:4px 10px;
    border-radius:999px;
    border:1px solid #233152;
    color:var(--muted);
    font-size:13px;
  }
  .btn{
    appearance:none;border:1px solid #25324f;background:#15203a;
    color:var(--text);padding:8px 14px;border-radius:12px;cursor:pointer;
    font-size:14px;
  }
  .btn.primary{border-color:#245bb5;background:#1b3b70}
  .btn:disabled{opacity:.5;cursor:default}
  .panel{
    background:var(--panel);
    border-radius:18px;
    border:1px solid #1b2946;
    padding:16px;
  }
  .qtext{
    font-size:24px;
    line-height:1.3;
    margin-bottom:12px;
  }
  .status{
    font-size:14px;
    color:var(--muted);
    min-height:1.5em;
  }
  .status.ok{color:var(--ok)}
  .status.bad{color:var(--wrong)}
  .answer-area{
    margin:10px 0 4px;
  }

  /* Jednoduch√© pole pro "desetinn√Ω" re≈æim */
  .whole-input{
    padding:8px 10px;
    border-radius:10px;
    border:1px solid #243356;
    background:#0f1729;
    color:var(--text);
    font-size:18px;
    width:160px;
  }
  .whole-input:focus{outline:none;border-color:var(--accent)}

  /* Zlomek ‚Äì dvƒõ kolonky a ƒç√°ra */
  .frac-wrapper{
    display:none;
    align-items:center;
    justify-content:flex-start;
    gap:6px;
  }
  .frac-box{
    display:inline-flex;
    flex-direction:column;
    align-items:stretch;
    justify-content:center;
  }
  .frac-input{
    width:120px;
    padding:4px 8px;
    border-radius:6px;
    border:1px solid #243356;
    background:#0f1729;
    color:var(--text);
    font-size:16px;
    text-align:center;
  }
  .frac-input:focus{outline:none;border-color:var(--accent)}
  .frac-bar{
    height:1px;
    background:#e5e7eb;
    margin:3px 0;
  }

  /* Kl√°vesnice */
  .kbd{
    margin-top:10px;
    display:grid;
    grid-template-columns:repeat(4, minmax(0,1fr));
    gap:6px;
  }
  .kbd button{
    padding:10px 0;
    font-size:18px;
    border-radius:10px;
    border:1px solid #243356;
    background:#101826;
    color:var(--text);
    cursor:pointer;
  }
  .kbd button:hover{background:#18233e}
  .kbd button.k-wide{
    grid-column:span 2;
  }

  .bottom-bar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:12px;
    gap:10px;
    flex-wrap:wrap;
  }

  /* Odmƒõny ‚Äì babiƒçky a ƒçert√≠ci */
  .icons-wrap{
    position:fixed;
    top:8px;
    right:10px;
    display:flex;
    flex-direction:column;
    gap:4px;
    z-index:10;
    font-size:18px;
  }
  .icons-line{
    display:flex;
    gap:4px;
    align-items:center;
  }
</style>
</head>
<body>
<div class="icons-wrap">
  <div class="icons-line">
    üëµ <span id="grannyCount">0</span>
  </div>
  <div class="icons-line">
    üòà <span id="devilCount">0</span>
  </div>
</div>

<div class="app">
  <header>
    <div class="tag">P≈ô√≠klad <span id="qIndex">1</span> / 6</div>
    <div class="tag">Spr√°vn√Ωch: <span id="qCorrect">0</span></div>
    <div class="tag">≈†patn√Ωch: <span id="qWrong">0</span></div>
    <div style="flex:1"></div>
    <button class="btn" id="btnReset">Nov√° ≈°estice</button>
  </header>

  <section class="panel">
    <div class="qtext" id="qText"></div>

    <div class="answer-area">
      <!-- jedna kolonka -->
      <input id="answerWhole" class="whole-input" autocomplete="off" inputmode="decimal" />
      <!-- zlomek -->
      <div id="fracWrapper" class="frac-wrapper">
        <span>=</span>
        <div class="frac-box">
          <input id="answerNum" class="frac-input" autocomplete="off" inputmode="numeric" />
          <div class="frac-bar"></div>
          <input id="answerDen" class="frac-input" autocomplete="off" inputmode="numeric" />
        </div>
      </div>
    </div>

    <div class="kbd" id="kbd">
      <button data-key="7">7</button>
      <button data-key="8">8</button>
      <button data-key="9">9</button>
      <button data-key="back">‚Üê</button>

      <button data-key="4">4</button>
      <button data-key="5">5</button>
      <button data-key="6">6</button>
      <button data-key="clear">C</button>

      <button data-key="1">1</button>
      <button data-key="2">2</button>
      <button data-key="3">3</button>
      <button data-key="-">‚àí</button>

      <button data-key="0">0</button>
      <button data-key=",">,</button>
      <button class="k-wide" data-key="frac">zlomkov√° ƒç√°ra</button>
    </div>

    <div class="bottom-bar">
      <div>
        <button class="btn primary" id="btnCheck">Ovƒõ≈ôit v√Ωsledek</button>
        <button class="btn" id="btnNext" disabled>Dal≈°√≠ p≈ô√≠klad</button>
      </div>
      <div id="status" class="status"></div>
    </div>
  </section>
</div>

<script>
/* ---------- pomocn√© funkce pro ƒç√≠sla ---------- */
function randInt(min, max){
  return Math.floor(Math.random()*(max-min+1))+min;
}
function choice(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}
function gcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b){ let t=a%b; a=b; b=t; }
  return a||1;
}
function fmtDec(x){
  // dvƒõ desetinn√° m√≠sta, o≈ôez√°n√≠ nul
  let s = x.toFixed(2);
  s = s.replace('.', ',');
  // o≈ô√≠zni zbyteƒçn√© nuly
  if(s.includes(',')){
    s = s.replace(/0+$/,'').replace(/,$/,'');
  }
  return s;
}
function toFrac(x){
  const sign = x<0 ? -1 : 1;
  x = Math.abs(x);
  let bestN = 0, bestD = 1, bestErr = 1e9;
  for(let d=1; d<=30; d++){
    let n = Math.round(x*d);
    let val = n/d;
    let err = Math.abs(val-x);
    if(err < bestErr-1e-10){
      bestErr = err;
      bestN = n; bestD = d;
    }
  }
  bestN *= sign;
  const g = gcd(bestN,bestD);
  bestN /= g; bestD /= g;
  return {n:bestN, d:bestD};
}
function fracToString(fr){
  const n = fr.n, d = fr.d;
  if(d===1) return String(n);
  return (n<0 ? '‚àí' + Math.abs(n) : String(n)) + '/' + d;
}

/* ---------- gener√°tory 6 typ≈Ø p≈ô√≠klad≈Ø ---------- */
// ƒç√≠slo s jedn√≠m desetinn√Ωm m√≠stem 0,2 a≈æ 9,9
function randDec10(min, max){
  const k = randInt(min*10, max*10);
  return k/10;
}
// ƒç√≠slo se dvƒõma desetinn√Ωmi m√≠sty
function randDec100(min, max){
  const k = randInt(min*100, max*100);
  return k/100;
}
function genType1(){
  // [a : 1/2 + b : c ‚àí d] ¬∑ e
  const a = randDec100(0.2,0.8);
  const b = -randDec100(0.2,0.7);
  const c = -randDec10(0.8,1.5);
  const d = randInt(5,12);
  const frac = choice([[2,5],[3,5],[3,4]]);
  const e = frac[0]/frac[1];

  const value = ((a/0.5) + (b/c) - d) * e;

  const txt = `[${fmtDec(a)} : 1/2 + (${fmtDec(b)}) : (${fmtDec(c)}) ‚àí ${d}] ¬∑ ${frac[0]}/${frac[1]} =`;
  return {text:txt, value};
}
function genType2(){
  // (A‚àíB) ¬∑ (C‚àíD) + E : (m/n)
  const A = randDec10(3,7);
  const B = randDec10(1,3);
  const C = randDec10(7,10);
  const D = randDec10(9,12);
  const E = -randDec100(1.0,2.0);
  const frac = choice([[3,5],[4,5],[5,6]]);
  const F = frac[0]/frac[1];

  const value = (A-B)*(C-D) + E/F;
  const txt = `(${fmtDec(A)} ‚àí ${fmtDec(B)}) ¬∑ (${fmtDec(C)} ‚àí ${fmtDec(D)}) + (${fmtDec(E)}) : ${frac[0]}/${frac[1]} =`;
  return {text:txt, value};
}
function genType3(){
  // (‚àíp/q) ¬∑ r/s + (dec) ¬∑ t/u
  const p = choice([3,4,5]);
  const q = choice([5,6,9]);
  const r = choice([2,3,4]);
  const s = choice([5,6,8]);
  const t = choice([1,2,3]);
  const u = choice([3,4,5]);
  const dec = -randDec10(0.4,1.2);

  const v1 = (-p/q)*(r/s);
  const v2 = dec*(t/u);
  const value = v1 + v2;

  const txt = `(${ -p }/${q}) ¬∑ ${r}/${s} + (${fmtDec(dec)}) ¬∑ ${t}/${u} =`;
  return {text:txt, value};
}
function genType4(){
  // (dec ‚àí 1/k) : ( (2/5) : (‚àí1/3) )
  const dec = randDec10(1.5,2.5);
  const k = choice([4,5,8,10]);
  const inner = (2/5) / (-1/3);
  const value = (dec - 1/k) / inner;

  const txt = `(${fmtDec(dec)} ‚àí 1/${k}) : (2/5 : (‚àí1/3)) =`;
  return {text:txt, value};
}
function genType5(){
  // (‚àídec) ¬∑ 2/9 + (‚àíp/q) ¬∑ 18/12
  const dec = randDec10(0.4,0.9);
  const p = choice([4,5,7,8]);
  const q = choice([6,9]);
  const value = (-dec)*(2/9) + (-p/q)*(18/12);
  const txt = `(${fmtDec(-dec)}) ¬∑ 2/9 + (‚àí${p}/${q}) ¬∑ 18/12 =`;
  return {text:txt, value};
}
function genType6(){
  // (4/5 ‚àí dec) : ( (‚àí2/3) : 3/5 )
  const dec = randDec10(1.1,1.9);
  const inner = (-2/3) / (3/5);
  const value = (4/5 - dec) / inner;
  const txt = `(4/5 ‚àí ${fmtDec(dec)}) : ((‚àí2/3) : 3/5) =`;
  return {text:txt, value};
}

/* vygeneruj novou sadu 6 p≈ô√≠klad≈Ø */
function generateQuestions(){
  const gens = [genType1, genType2, genType3, genType4, genType5, genType6];
  const qs = gens.map(g => {
    const q = g();
    const fr = toFrac(q.value);
    q.showDec = fmtDec(q.value);
    q.showFrac = fracToString(fr);
    return q;
  });
  return qs;
}

/* ---------- stav ---------- */
let questions = generateQuestions();
let index = 0;
let correctCount = 0;
let wrongCount = 0;
let grannyCount = 0;
let devilCount = 0;
let roundFinished = false;

const elQText = document.getElementById('qText');
const elQIndex = document.getElementById('qIndex');
const elQCorrect = document.getElementById('qCorrect');
const elQWrong = document.getElementById('qWrong');
const elStatus = document.getElementById('status');

const elWhole = document.getElementById('answerWhole');
const elFracWrap = document.getElementById('fracWrapper');
const elNum = document.getElementById('answerNum');
const elDen = document.getElementById('answerDen');

const elBtnCheck = document.getElementById('btnCheck');
const elBtnNext = document.getElementById('btnNext');
const elBtnReset = document.getElementById('btnReset');
const elKbd = document.getElementById('kbd');

const elGrannyCount = document.getElementById('grannyCount');
const elDevilCount = document.getElementById('devilCount');

let fractionMode = false;
let activeInput = elWhole;

/* ---------- UI / status ---------- */
function showQuestion(){
  const q = questions[index];
  elQText.textContent = q.text;
  elQIndex.textContent = String(index+1);
  clearAnswer();
  setStatus("");
}

function setStatus(msg, kind){
  elStatus.textContent = msg;
  elStatus.className = "status";
  if(kind === "ok") elStatus.classList.add("ok");
  if(kind === "bad") elStatus.classList.add("bad");
}

function clearAnswer(){
  elWhole.value = "";
  elNum.value = "";
  elDen.value = "";
  fractionMode = false;
  elWhole.style.display = "inline-block";
  elFracWrap.style.display = "none";
  activeInput = elWhole;
  elBtnNext.disabled = true;
  elBtnCheck.disabled = false;
  elWhole.focus();
}

/* ---------- ƒçten√≠ odpovƒõdi ---------- */
function parseNumber(str){
  const s = str.replace(',', '.').trim();
  if(!s) return null;
  const n = Number(s);
  return Number.isFinite(n) ? n : null;
}
function getUserValue(){
  if(fractionMode){
    const a = parseNumber(elNum.value);
    const b = parseNumber(elDen.value);
    if(a === null || b === null || b === 0) return {ok:false, msg:"Dopl≈à ƒçitatel i jmenovatel (jmenovatel nesm√≠ b√Ωt 0)."};
    return {ok:true, value:a / b};
  }else{
    const a = parseNumber(elWhole.value);
    if(a === null) return {ok:false, msg:"Zadej v√Ωsledek (desetinn√° ƒç√°rka je , )."};
    return {ok:true, value:a};
  }
}

/* ---------- kontrola ---------- */
function finishRoundOnce(){
  if(roundFinished) return;
  roundFinished = true;
  grannyCount++;
  elGrannyCount.textContent = String(grannyCount);
}

function checkAnswer(){
  const res = getUserValue();
  if(!res.ok){
    setStatus(res.msg, "bad");
    return;
  }
  const user = res.value;
  const correct = questions[index].value;
  const diff = Math.abs(user - correct);

  if(diff < 1e-6){
    correctCount++;
    elQCorrect.textContent = String(correctCount);
    setStatus("Spr√°vnƒõ üëå", "ok");
  }else{
    wrongCount++;
    devilCount++;
    elQWrong.textContent = String(wrongCount);
    elDevilCount.textContent = String(devilCount);
    const q = questions[index];
    setStatus("≈†patnƒõ. Spr√°vn√Ω v√Ωsledek je "+q.showDec+" = "+q.showFrac+".", "bad");
  }

  // po 6. p≈ô√≠kladu ‚Äì odmƒõna babiƒçka
  if(index === questions.length-1){
    finishRoundOnce();
  }

  elBtnCheck.disabled = true;
  elBtnNext.disabled = (index >= questions.length-1);
}

/* ---------- dal≈°√≠ / reset ---------- */
function nextQuestion(){
  if(index < questions.length-1){
    index++;
    showQuestion();
  }
  if(index >= questions.length-1){
    elBtnNext.disabled = true;
  }
}

function resetAll(){
  questions = generateQuestions();
  index = 0;
  correctCount = 0;
  wrongCount = 0;
  roundFinished = false;
  elQCorrect.textContent = "0";
  elQWrong.textContent = "0";
  showQuestion();
}

/* ---------- kl√°vesnice ---------- */
function setActive(input){
  activeInput = input;
}
elWhole.addEventListener('focus', ()=>setActive(elWhole));
elNum.addEventListener('focus', ()=>setActive(elNum));
elDen.addEventListener('focus', ()=>setActive(elDen));

function handleKey(key){
  if(key === "frac"){
    if(!fractionMode){
      fractionMode = true;
      elWhole.style.display = "none";
      elFracWrap.style.display = "inline-flex";
      if(elWhole.value.trim()){
        elNum.value = elWhole.value;
      }
      activeInput = elNum.value.trim() ? elDen : elNum;
    }else{
      activeInput = (activeInput === elNum ? elDen : elNum);
    }
    activeInput.focus();
    return;
  }
  if(key === "clear"){
    activeInput.value = "";
    activeInput.focus();
    return;
  }
  if(key === "back"){
    activeInput.value = activeInput.value.slice(0,-1);
    activeInput.focus();
    return;
  }

  let v = activeInput.value;
  if(key === "-"){
    if(v.includes("-")) return;
    if(v.trim().length === 0){
      activeInput.value = "-";
    }
    activeInput.focus();
    return;
  }
  if(key === ","){
    if(v.includes(",") || v.includes(".")) return;
    if(!v) v = "0";
    activeInput.value = v + ",";
    activeInput.focus();
    return;
  }
  if(/[0-9]/.test(key)){
    activeInput.value += key;
    activeInput.focus();
    return;
  }
}

elKbd.addEventListener('click', e=>{
  const btn = e.target.closest('button[data-key]');
  if(!btn) return;
  const key = btn.getAttribute('data-key');
  handleKey(key);
});

/* Enter = ovƒõ≈ôit */
document.addEventListener('keydown', e=>{
  if(e.key === "Enter"){
    e.preventDefault();
    if(!elBtnCheck.disabled) checkAnswer();
  }
});

/* ---------- tlaƒç√≠tka ---------- */
elBtnCheck.addEventListener('click', checkAnswer);
elBtnNext.addEventListener('click', nextQuestion);
elBtnReset.addEventListener('click', resetAll);

/* start */
showQuestion();
</script>
</body>
</html>
